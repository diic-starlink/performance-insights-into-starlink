% last-modified: 08.08.2024
% how-to-reproduce: /src/db-controller/notebooks/traceroute.ipynb

\subsection{Traceroute Analysis} \label{sec:traceroute-analysis}

Looking at traceroute results, we can make conclusions about the routing
behavior of Starlink network devices. In the data we gathered more than forty
million traceroute measurements. Those include primarily built-in measurements
from RIPE Atlas Starlink probes (ASN14593).

\subsection*{Reachability of Target Servers}

The data contains various target servers. However, running a traceroute to them
is not similarly successful. Table~\ref{fig:traceroute-success-rates} shows the
traceroute results for servers with at least one successful traceroute.

\begin{table}
	\footnotesize
	\caption{Success Rates of Traceroute per Target Server}
	\label{fig:traceroute-success-rates}
	\begin{tabular}{llrrr}
		\toprule
		  & Destination    & Success Events & Total Events & Success Rate \\
		\midrule
		0 & 192.5.5.241    & 53447          & 2764536      & 0.019333     \\
		1 & 192.203.230.10 & 161792         & 2754657      & 0.058734     \\
		2 & 198.97.190.53  & 961501         & 2762322      & 0.348077     \\
		3 & 199.7.83.42    & 1024109        & 2764224      & 0.370487     \\
		4 & 199.7.91.13    & 1024454        & 2762612      & 0.370828     \\
		5 & 193.0.14.129   & 1025631        & 2770381      & 0.370213     \\
		6 & 202.12.27.33   & 1021441        & 2763754      & 0.369585     \\
		7 & 192.33.4.12    & 1022587        & 2763832      & 0.369989     \\
		8 & 192.36.148.17  & 223088         & 2763589      & 0.080724     \\
		\bottomrule
	\end{tabular}
\end{table}

One sees that most servers have 34~\% to 37~\% success rate. However, \#1, \#2,
and \#8 have far lower success rates with less than 10~\%. It is unclear why
such a behavior appear, but similar was reported by
Brownlee~\cite{Brownlee2021}. However, his numbers were higher than the ones
here. The numbers are still not comparable, as Brownlee performed the tests on
an earlier time series (2012~--2019) and not specifically for Starlink probes.

\begin{wraptable}{r}{4cm}
	\footnotesize
	\caption{Servers that were never reached during a Traceroute Measurement}
	\label{fig:unreachable-servers}
	\begin{tabular}{l}
		\toprule
		Destination     \\
		\midrule
		193.0.19.60     \\
		170.247.170.2   \\
		104.237.152.132 \\
		198.41.0.4      \\
		45.33.72.12     \\
		139.162.27.28   \\
		78.46.48.134    \\
		193.0.19.59     \\
		213.133.109.134 \\
		199.9.14.201    \\
		\bottomrule
	\end{tabular}
\end{wraptable}

Still, it becomes apparent that some servers do not even accept traceroutes.
Table~\ref{fig:unreachable-servers} lists those servers that never got a
successful traceroute.

\subsection*{Routing Behavior}

\begin{figure}
	\includegraphics[width=\textwidth]{chapters/4-results/traceroute/img/kiribati-example-traceroute.pdf}
	\caption{Visualization of a Traceroute from Kiribati}
	\label{fig:kiribati-example-traceroute}
\end{figure}

First, we found that the satellite hops are likely invisible to the traceroute.
We conclude that as there are no hops visible above water, even for probes
located in remote regions, e.g., Kiribati in the Pacific Ocean. In
Figure~\ref{fig:kiribati-example-traceroute}, one can see a visualization of a
traceroute result from Kiribati to \textit{f.root-servers.net}. One can see
that the first visible hop is located in New~Zealand or an island to the north
of New~Zealand. However, if satellites were visible, we'd be able to observe
more satellites.

% TODO: Cite the statement that 4000km is too large for a single satellite. Everybody would ask here now: "But how much can they actually cover?"
Coming from the first insight, we can also conclude that \ac{ISLs} are enabled.
If they were not, we would likely not be able to see a successful traceroute
from Kiribati to a location. The next closest known \ac{PoP} is on Hawaii.
However, the distance between both is 4000~km, which is more than a single
satellite can cover \cite{Pekhterev2021}. Aside from that, we do not observe the usage of the
\ac{PoP} in Hawaii, but in more distant locations, which just strengthens the
argument. Therefore, we conclude that \ac{ISLs} are enabled. This is special
interest, as it was not clear in recent research \cite{DBLP:conf/hotnets/HauriBGS20}.

\todo{Verify that this poses actually a privacy concern / Remove if there is
	no proof or no privacy concern}

\subsection*{Privacy Concerns in Traceroute Data}

One of the most important responsibilities of an \ac{ISP} is to ensure the
privacy of its users. This also includes to route traffic only in trusted
countries. In the case of Starlink, we were able to observe a different
behavior. We looked at a slice of the built-in traceroute measurements from
German Starlink probes and analyzed their most common targets. We filtered for
anycasted servers (e.g., *.root-servers.net) and bogon IPs (i.e., IPs that
cannot be associated with metadata).

% Input IP Hitlist
\begin{table}
	\caption{IP Hitlist for Built-In Traceroute Measurements}
	\label{fig:ip-hitlist-traceroute}
	\begin{tabular}{rllll}
		\toprule
		Hits  & City              & Country       & Organization & IP Address      \\
		\midrule
		10634 & Frankfurt am Main & Germany       & AS1299       & 62.115.37.20    \\
		8202  & Offenbach         & Germany       & Unknown      & 80.81.192.154   \\
		6207  & Amsterdam         & Netherlands   & Unknown      & 193.239.116.217 \\
		5582  & Frankfurt am Main & Germany       & AS2914       & 213.198.72.18   \\
		5257  & Frankfurt am Main & Germany       & AS3257       & 89.149.137.14   \\
		4932  & Chicago           & United States & AS14593      & 206.224.65.178  \\
		4916  & Chicago           & United States & AS14593      & 206.224.65.180  \\
		4850  & Chicago           & United States & AS14593      & 206.224.65.182  \\
		4755  & Chicago           & United States & AS14593      & 206.224.65.184  \\
		4358  & Miami             & United States & AS49791      & 81.31.213.126   \\
		4333  & ZÃ¼rich            & Switzerland   & Unknown      & 185.1.147.30    \\
		4256  & Tokyo             & Japan         & Unknown      & 210.173.176.242 \\
		4179  & Chicago           & United States & AS14593      & 206.224.65.186  \\
		4035  & Chicago           & United States & AS14593      & 206.224.65.192  \\
		4014  & Frankfurt am Main & Germany       & AS6762       & 213.144.184.30  \\
		4010  & Chicago           & United States & AS14593      & 206.224.65.190  \\
		4005  & Chicago           & United States & AS14593      & 206.224.65.188  \\
		4002  & Frankfurt am Main & Germany       & AS1299       & 62.115.124.118  \\
		3990  & Singapore         & Singapore     & AS2497       & 202.232.1.69    \\
		3827  & Frankfurt am Main & Germany       & AS6939       & 72.52.92.70     \\
		\bottomrule
	\end{tabular}
\end{table}

In Table~\ref{fig:ip-hitlist-traceroute}, the top twenty most frequent hits of
IP addresses are shown. The IP addresses are joined with data from IPinfo. As
traffic goes from a German probe to an anycasted server, located in Germany,
one would expect little traffic outside Germany, and none outside Europe. The
top five IP addresses are located within or close to Germany, but the next five
already involve traffic to the United~States. Here, we observe an unexpected
behavior. Assuming that the data is not flawed, this is a clear violation of
guiding privacy principles.

